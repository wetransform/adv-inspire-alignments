<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <base prefix="ba1" location="../base-functions.halex.alignment.xml"/>
    <cell relation="eu.esdihumboldt.hale.align.retype" id="C1adf2663-91d3-4e63-99b0-2806db5d9191" priority="normal">
        <source>
            <class>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </class>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Ceb874d7d-ec44-43ba-ba26-2004b0a8c78e" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="amtlicheFlaeche" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="areaValue" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="custom:alignment:adv.uom.toucum" id="C033c7108-6b60-4abd-92a4-4cf19ee508a0" priority="normal">
        <source name="uom">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="amtlicheFlaeche" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="uom"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="areaValue" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="uom"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cc51360e3-edaa-45a0-9e45-bcf77eb69c99" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="beginnt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C7f209965-d6a1-4cf7-8b1e-bf4ff7ebe028" priority="normal">
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cab00243d-d276-44ff-aff0-9049cefb1a6d" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="position" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="geometry" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="copyGeometries"/>
        <parameter value="true" name="ignoreNamespaces"/>
        <parameter value="true" name="structuralRename"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Ce6bf7947-2b16-446e-b4c9-5d0e39e5c0c8" priority="normal">
        <source name="id">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstueckskennzeichen" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Cf5198186-7592-4d3c-9339-a402a3f09d46" priority="normal">
        <source name="id">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstueckskennzeichen" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Ca24e4975-416e-48e1-9c9c-7e90d781fe1f" priority="normal">
        <source name="id">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstueckskennzeichen" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C12a4a855-a379-4274-9691-f95e3edfe0bf" priority="normal">
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C9638bc4e-53b7-4b20-838b-b25a68915654" priority="normal">
        <source name="var">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstuecksnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_Flurstuecksnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="zaehler" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <source name="var">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstuecksnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_Flurstuecksnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="nenner" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target name="result">
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="label" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
if (nenner) {
  "$zaehler/$nenner"
}
else {
  zaehler
}
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Falls ein *nenner* vorhanden ist das Ergebnis repräsentiert als `zaehler/nenner`, ansonsten wird nur der *zaehler* angegeben.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C8fe37216-c8fe-40ef-a5f5-41fabf8cc024" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstueckskennzeichen" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nationalCadastralReference" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.geometric.interiorPoint" id="C3e2e3e1e-449b-4985-b1ce-f4a3a5fa8198" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="position" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="choice" ns="http://www.opengis.net/gml/3.2/AbstractGeometry"/>
                <child name="Surface" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="referencePoint" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Point" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C744bc64e-0688-4be1-9ea2-a80e5082537b" priority="normal">
        <source>
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="zeitpunktDerEntstehung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C41ceffd5-78c3-4f15-a342-5e6f33b25b5f" priority="normal">
        <target>
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C96c64684-6750-49e4-9ec9-ef76a952baa5" priority="normal">
        <source name="var">
            <property>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="flurstueckskennzeichen" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target name="result">
            <property>
                <type name="CadastralParcelType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="zoning" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Land und Gemarkung: 1.-6. Stelle
def landGemarkung = flurstueckskennzeichen[0..5]
// Flurnummer: 7.-9. Stelle
def flur = flurstueckskennzeichen[6..8]

if (flur == '___') {
  // "Eltern-Zoning" ist Gemarkung
  "#CadastralZoning_$landGemarkung" as String
}
else {
  // "Eltern-Zoning" ist GemarkungsteilFlur
  "#CadastralZoning_${landGemarkung}${flur}" as String
} 
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Je nachdem ob es einen übergeordneten Gemarkungsteil/Flur gibt, wird die Verknüpfung zum Zoning hergestellt, das entweder einen Gemarkungsteil/Flur repräsentiert, oder eine Gemarkung.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C8a96eace-7e17-4c0d-b649-a7fd73b0757c" priority="lowest">
        <source>
            <class>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
import com.vividsolutions.jts.geom.*
import com.vividsolutions.jts.io.WKTReader
import com.vividsolutions.jts.algorithm.CGAlgorithms
import eu.esdihumboldt.hale.common.instance.geometry.DefaultGeometryProperty

class Processor {

    static final GeometryFactory factory = new GeometryFactory()
    
    Polygon convert(Polygon p, areaThreshold) {
        if (p.numInteriorRing &gt; 0) {
            // has holes
            LinearRing shell = p.exteriorRing
            List&lt;LinearRing&gt; holes = []
            
            for (int i = 0; i &lt; p.numInteriorRing; i++) {
                LinearRing hole = p.getInteriorRingN(i)
                
                // determine area of hole
                try {
                    double area = CGAlgorithms.signedArea(hole.coordinates)
                    // println "Area of hole: $area"
                    if (area &gt; areaThreshold) {
                        // keep hole
                        holes &lt;&lt; hole
                        _log.info("Loch in Zoning mit Fläche ${area} beibehalten")
                    }
                    else {
                        // throw hole away
                    }
                } catch (Exception e) {
                    // ignore
                }
            }
            
            factory.createPolygon(shell, holes.toArray(new LinearRing[holes.size()]))
        }
        else {
            // no holes
            p
        }
    }
    
    MultiPolygon convert(MultiPolygon mp, areaThreshold) {
        if (mp.numGeometries) {
            Polygon[] polygons = new Polygon[mp.numGeometries]
            for (int i = 0; i &lt; mp.numGeometries; i++) {
                polygons[i] = convert(mp.getGeometryN(i), areaThreshold)
            }
            factory.createMultiPolygon(polygons)
        }
        else {
            // empty
            mp
        }
    }
    
    Geometry convert(Geometry g, areaThreshold) {
        // nothing to do
        g
    }

}


// Geometrien wenn aus zugehörigen Gemarkungen bestimmen
def _land = _source.p.schluessel.AX_Bundesland_Schluessel.land.value()
def geoms = _.context.collector().GemarkungGeometrien[_land].clear()
if (geoms) {
	geoms = _.geom.findAll(geoms)
}

// führe den Join nicht aus wenn keine assoziierten Gemarkungsgeometrien
// vorhanden sind
if (!geoms) {
	throw new NoResultException()
}

// bilde Union
def union = _.geom.union(geoms)

if (!union) {
	_log.error("Unable to determine union for geometries $geoms")
	throw new NoResultException()
}

// remove small holes created due to interpolation
def g = union.geometry
g = new Processor().convert(g, _project.variables.ERROR_AREA_THRESHOLD as double)
union = new DefaultGeometryProperty(union.CRSDefinition, g)

// bilde interiorPoint aus Union
def interiorPoint = _.geom.interiorPoint(union)

// erzeuge CadastralZoning (vor Eigenschaftstransformationen)
_target {
	geometry {
		MultiSurface(union)
	}
	if (interiorPoint) {
		referencePoint {
			Point(interiorPoint)
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Hier wird ein INSPIRE *CadastralZoning* zu einem entsprechenden *AX_Bundesland* erstellt.

Für die Geometrie des Bundeslands werden die Geometrien der zuvor gebildeten Gemarkungen zusammengefasst.
Außerdem wird für den Referenz-Punkt ein Punkt innerhalb dieser Fläche bestimmt.

Falls keine *CadastralZonings* zu den Gemarkungen für das Bundesland als Teil der Transformation gebildet wurden, wird zu diesem Bundesland kein *CadastralZoning* in den Ausgangsdaten erstellt.
</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.join" id="C6ea88b52-bfd5-417d-81d0-3ff64788eb3a" priority="lower">
        <source name="types">
            <class>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <source name="types">
            <class>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </class>
        </target>
        <complexParameter name="join">
            <jp:join-parameter xmlns:jp="http://www.esdi-humboldt.eu/hale/join">
                <class>
                    <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                </class>
                <class>
                    <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                </class>
                <jp:condition>
                    <property>
                        <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkungsnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                    <property>
                        <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkungsnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                </jp:condition>
                <jp:condition>
                    <property>
                        <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                    <property>
                        <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                </jp:condition>
            </jp:join-parameter>
        </complexParameter>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
import com.vividsolutions.jts.geom.*
import com.vividsolutions.jts.io.WKTReader
import com.vividsolutions.jts.algorithm.CGAlgorithms
import eu.esdihumboldt.hale.common.instance.geometry.DefaultGeometryProperty

class Processor {

    static final GeometryFactory factory = new GeometryFactory()
    
    Polygon convert(Polygon p, areaThreshold) {
        if (p.numInteriorRing &gt; 0) {
            // has holes
            LinearRing shell = p.exteriorRing
            List&lt;LinearRing&gt; holes = []
            
            for (int i = 0; i &lt; p.numInteriorRing; i++) {
                LinearRing hole = p.getInteriorRingN(i)
                
                // determine area of hole
                try {
                    double area = CGAlgorithms.signedArea(hole.coordinates)
                    // println "Area of hole: $area"
                    if (area &gt; areaThreshold) {
                        // keep hole
                        holes &lt;&lt; hole
                        _log.info("Loch in Zoning mit Fläche ${area} beibehalten")
                    }
                    else {
                        // throw hole away
                    }
                } catch (Exception e) {
                    // ignore
                }
            }
            
            factory.createPolygon(shell, holes.toArray(new LinearRing[holes.size()]))
        }
        else {
            // no holes
            p
        }
    }
    
    MultiPolygon convert(MultiPolygon mp, areaThreshold) {
        if (mp.numGeometries) {
            Polygon[] polygons = new Polygon[mp.numGeometries]
            for (int i = 0; i &lt; mp.numGeometries; i++) {
                polygons[i] = convert(mp.getGeometryN(i), areaThreshold)
            }
            factory.createMultiPolygon(polygons)
        }
        else {
            // empty
            mp
        }
    }
    
    Geometry convert(Geometry g, areaThreshold) {
        // nothing to do
        g
    }

}

def geoms

// Geometrien wenn möglich aus zugehörigen Fluren bestimmen
def _land = _source.p.schluessel.AX_Gemarkung_Schluessel.land.value()
def _gemarkung = _source.p.schluessel.AX_Gemarkung_Schluessel.gemarkungsnummer.value()
if (_land &amp;&amp; _gemarkung) {
	geoms = _.context.collector().FlurGeometrien[_land][_gemarkung].clear()
}

// ansonsten Geometrien aus Flurstücken (in manchen Bundesländern gibt es keine Flure/Gemarkungsteile)
if (!geoms) {
	geoms = _source.links.AX_Flurstueck.p.position.list()
}

if (geoms) {
	geoms = _.geom.findAll(geoms)
}

// führe den Join nicht aus wenn keine assoziierten Flurstücke
// mit Geometrien vorhanden sind
if (!geoms) {
	throw new NoResultException()
}

// bilde Union
def union = _.geom.union(geoms)

if (!union) {
	_log.error("Unable to determine union for geometries $geoms")
	throw new NoResultException()
}

// remove small holes created due to interpolation
def g = union.geometry
g = new Processor().convert(g, _project.variables.ERROR_AREA_THRESHOLD as double)
union = new DefaultGeometryProperty(union.CRSDefinition, g)

// speichere aggregierte Geometrie für Bildung von Bundesland
if (_land) {
	_.context.collector().GemarkungGeometrien[_land] &lt;&lt; union
}

// bilde interiorPoint aus Union
def interiorPoint = _.geom.interiorPoint(union)

// erzeuge CadastralZoning (vor Eigenschaftstransformationen)
_target {
	geometry {
		MultiSurface(union)
	}
	if (interiorPoint) {
		referencePoint {
			Point(interiorPoint)
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Hier wird ein INSPIRE *CadastralZoning* zu einer entsprechenden *AX_Gemarkung* erstellt.

Zu einer *AX_Gemarkung* werden über den Gemarkungsschlüssel von *AX_Flurstueck* alle dazugehörigen Flurstücke bestimmt.

Falls als Teil der Transformation aus entsprechenden Fluren oder Gemarkungsteilen *CadastralZoning*-Objekte erstellt wurden, werden die dort gebildeten Geometrien für die Gemarkung zusammengefasst. Andernfalls werden die Flurstücke der Gemarkung, sofern vorhanden, für die Geometrie des *CadastralZoning* zusammengefasst. Außerdem wird für den Referenz-Punkt ein Punkt innerhalb dieser Fläche bestimmt.

Falls keine Flure/Gemarkungsteile oder Flurstücke zu der Gemarkung in den Quell-Daten vorhanden sind, wird zu dieser Gemarkung kein *CadastralZoning* in den Ausgangsdaten erstellt.
</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.join" id="Cb3d47ecd-2e54-4637-a92c-de4055bd0d91" priority="low">
        <source name="types">
            <class>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <source name="types">
            <class>
                <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </class>
        </source>
        <target>
            <class>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </class>
        </target>
        <complexParameter name="join">
            <jp:join-parameter xmlns:jp="http://www.esdi-humboldt.eu/hale/join">
                <class>
                    <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                </class>
                <class>
                    <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                </class>
                <jp:condition>
                    <property>
                        <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_GemarkungsteilFlur_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                    <property>
                        <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkungsnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                </jp:condition>
                <jp:condition>
                    <property>
                        <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_GemarkungsteilFlur_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                    <property>
                        <type name="AX_FlurstueckType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                        <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                    </property>
                </jp:condition>
            </jp:join-parameter>
        </complexParameter>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
import com.vividsolutions.jts.geom.*
import com.vividsolutions.jts.io.WKTReader
import com.vividsolutions.jts.algorithm.CGAlgorithms
import eu.esdihumboldt.hale.common.instance.geometry.DefaultGeometryProperty

class Processor {

    static final GeometryFactory factory = new GeometryFactory()
    
    Polygon convert(Polygon p, areaThreshold) {
        if (p.numInteriorRing &gt; 0) {
            // has holes
            LinearRing shell = p.exteriorRing
            List&lt;LinearRing&gt; holes = []
            
            for (int i = 0; i &lt; p.numInteriorRing; i++) {
                LinearRing hole = p.getInteriorRingN(i)
                
                // determine area of hole
                try {
                    double area = CGAlgorithms.signedArea(hole.coordinates)
                    // println "Area of hole: $area"
                    if (area &gt; areaThreshold) {
                        // keep hole
                        holes &lt;&lt; hole
                        _log.info("Loch in Zoning mit Fläche ${area} beibehalten")
                    }
                    else {
                        // throw hole away
                    }
                } catch (Exception e) {
                    // ignore
                }
            }
            
            factory.createPolygon(shell, holes.toArray(new LinearRing[holes.size()]))
        }
        else {
            // no holes
            p
        }
    }
    
    MultiPolygon convert(MultiPolygon mp, areaThreshold) {
        if (mp.numGeometries) {
            Polygon[] polygons = new Polygon[mp.numGeometries]
            for (int i = 0; i &lt; mp.numGeometries; i++) {
                polygons[i] = convert(mp.getGeometryN(i), areaThreshold)
            }
            factory.createMultiPolygon(polygons)
        }
        else {
            // empty
            mp
        }
    }
    
    Geometry convert(Geometry g, areaThreshold) {
        // nothing to do
        g
    }

}


// sammle Geometrien von assoziierten Flurstücken

// Flurnummer als Zahl
def flur = _source.p.schluessel.AX_GemarkungsteilFlur_Schluessel.gemarkungsteilFlur.value() as Integer
// alle Flurstücke der Gemarkung
def fs = _source.links.AX_Flurstueck.list()
fs = fs.findAll {
  // flur aus flurnummer bestimmen
  def stueckFlur = it.p.flurnummer.value()
  
  if (stueckFlur == null) { // flurnummer ist ggf. nicht gesetzt (z.B. Berlin)
    // stattdessen flur aus Kennzeichen extrahieren
    def kennzeichen = it.p.flurstueckskennzeichen.value()
    if (kennzeichen) {
      stueckFlur = kennzeichen[6..8] as Integer
    }
  }
  
  // Auswahl aller Objekte mit gleicher Flur
  stueckFlur == flur
}
def geoms = fs.collect {
  it.p.position.first()
}
if (geoms) {
  geoms = _.geom.findAll(geoms)
}

// führe den Join nicht aus wenn keine assoziierten Flurstücke
// mit Geometrien vorhanden sind
if (!geoms) {
  throw new NoResultException()
}

// bilde Union
def union = _.geom.union(geoms)

if (!union) {
  _log.error("Unable to determine union for geometries $geoms")
  throw new NoResultException()
}

// remove small holes created due to interpolation
def g = union.geometry
g = new Processor().convert(g, _project.variables.ERROR_AREA_THRESHOLD as double)
union = new DefaultGeometryProperty(union.CRSDefinition, g)

// speichere aggregierte Geometrie für Bildung von Gemarkung
def _land = _source.p.schluesselGesamt.value()
def _gemarkung = _source.p.schluessel.AX_GemarkungsteilFlur_Schluessel.gemarkung.value()
if (_land &amp;&amp; _gemarkung) {
	_.context.collector().FlurGeometrien[_land][_gemarkung] &lt;&lt; union
}

// bilde interiorPoint
def interiorPoint = _.geom.interiorPoint(union)

_target {
  geometry {
  	MultiSurface( union )
  }
  if (interiorPoint) {
    referencePoint {
      Point(interiorPoint)
    }
  }
}
</core:text>
        </complexParameter>
        <documentation>Hier wird ein INSPIRE *CadastralZoning* zu einem entsprechenden *AX_GemarkungsteilFlur* erstellt.

Zu einem *AX_GemarkungsteilFlur* werden über den Gemarkungsschlüssel von *AX_Flurstueck* alle dazugehörigen Flurstücke bestimmt.

Falls keine Flurstücke zu dem Gemarkungsteil oder Flur in den Quell-Daten vorhanden sind, wird zu diesem Gemarkungsteil oderFlur kein *CadastralZoning* in den Ausgangsdaten erstellt.

Falls Flurstücke vorhanden sind werden die Geometrien der Flurstücke für die Geometrie des *CadastralZoning* zusammengefasst. Außerdem wird für den Referenz-Punkt ein Punkt innerhalb dieser Fläche bestimmt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C5bfc7fdc-a782-48f1-b471-86da4c97a8ee" priority="normal">
        <source>
            <property>
                <type name="AA_NREOType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="beginnt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C3f86cfe1-7de4-41c0-9b0a-de46fd576ae4" priority="normal">
        <source>
            <property>
                <type name="AA_NREOType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AA_Lebenszeitintervall" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="endet" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cc2df1716-c68b-414c-ae38-d976a5b406eb" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="estimatedAccuracy" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C7104c209-6955-4bc1-b4c3-1e89f1a4c720" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="estimatedAccuracy" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="uom"/>
            </property>
        </target>
        <parameter value="m" name="value"/>
        <documentation>Ein Wert wird für dieses Attribut benötigt auch wenn `estimatedAccuracy` keinen Wert hat, falls der `nilReason` angegeben ist (aufgrund der XML Schema Definition).</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C4f9d30f6-089e-4ed1-bc24-d920802bc726" priority="normal">
        <source name="id">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C4783b82c-e826-47d7-a581-77dfa2f25da4" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C52231e47-4998-4d7c-b32b-cb3e06241c8e" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Cfa132fe1-72f4-4db6-b353-c471abd40924" priority="normal">
        <source name="id">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Cce51c49c-f979-4c6c-abb2-4f7a0ce3e616" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Cec1a368e-3449-4678-af5e-fbc6e9e07fad" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Cb6e11047-8593-4f2e-92da-d640363dc9fe" priority="normal">
        <source name="id">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C3d6ab9ff-bf8f-4146-8e82-07b7af00bd3c" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C7c4f84f9-d3e2-45c0-b152-901ca904de14" priority="normal">
        <source name="id">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C73c410cc-d6eb-4015-a834-c4221ef84a02" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C39709ff3-104f-4c1d-b086-7854af956450" priority="normal">
        <source>
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_Bundesland_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="label" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cd3503205-d3dd-4065-b890-f0ca7bc48ab3" priority="normal">
        <source>
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="gemarkungsnummer" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="label" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C9dfc4c6d-358f-435f-98f6-fec4fc45f55a" priority="normal">
        <source>
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_GemarkungsteilFlur_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="gemarkungsteilFlur" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="label" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="C31124838-4e0d-4aa1-a7f9-8aec658f8c1d" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="level" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/CadastralZoningLevelValue/1stOrder" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="C53c83041-5072-487b-a392-2fbaf06d82d1" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="level" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/CadastralZoningLevelValue/2ndOrder" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="C0d3fb9c4-6649-48b8-8075-bd59c4109c92" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="level" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/CadastralZoningLevelValue/3rdOrder" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="C71264450-10bc-4227-be22-bc8fdd0daa4f" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="levelName" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="LocalisedCharacterString" ns="http://www.isotc211.org/2005/gmd"/>
            </property>
        </target>
        <parameter value="Bundesland" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="Cb0e7cd17-4e6c-4557-a909-ee7240ec8029" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="levelName" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="LocalisedCharacterString" ns="http://www.isotc211.org/2005/gmd"/>
            </property>
        </target>
        <parameter value="Gemarkung" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign.bound" id="Cd6aee0b2-e063-4ce5-b2db-0eddb8890b4b" priority="normal">
        <source name="anchor">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="levelName" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="LocalisedCharacterString" ns="http://www.isotc211.org/2005/gmd"/>
            </property>
        </target>
        <parameter value="GemarkungsteilFlur" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C159c6efe-06b3-4b3c-a23f-6b97a2cb6188" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="levelName" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="LocalisedCharacterString" ns="http://www.isotc211.org/2005/gmd"/>
                <child name="locale"/>
            </property>
        </target>
        <parameter value="deu" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C6539fc3b-8076-4c5c-9567-5a754c4761f9" priority="normal">
        <source name="spelling">
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="bezeichnung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="name" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="DLKM" name="source"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="Ca3062f07-047a-43f0-852d-ce8d1759680e" priority="normal">
        <source name="spelling">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="bezeichnung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="name" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="DLKM" name="source"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C40b4cdfb-7e70-4357-8ea8-75dc3dc4fab4" priority="normal">
        <source name="spelling">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="bezeichnung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="name" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="DLKM" name="source"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C89481ddb-6e11-4224-94e4-3c8693720b76" priority="normal">
        <source>
            <property>
                <type name="AX_BundeslandType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nationalCadastalZoningReference" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C477b8046-eca5-46d5-ac8d-17447e20dd02" priority="normal">
        <source>
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nationalCadastalZoningReference" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cf39ce03f-c797-4bb5-a633-e244b1d715fe" priority="normal">
        <source>
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluesselGesamt" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nationalCadastalZoningReference" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ccdd35fbd-03f9-4740-9807-a15d901e43c7" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="originalMapScaleDenominator" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.formattedstring" id="C568300d0-2316-4d88-9aee-34f1b4cf2a0f" priority="normal">
        <source name="var">
            <property>
                <type name="AX_GemarkungType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_Gemarkung_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="upperLevelUnit" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="#CadastralZoning_{schluessel.AX_Gemarkung_Schluessel.land}" name="pattern"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.formattedstring" id="C14174a15-b4b0-4278-9d2c-93243485710f" priority="normal">
        <source name="var">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_GemarkungsteilFlur_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="gemarkung" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <source name="var">
            <property>
                <type name="AX_GemarkungsteilFlurType" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="AX_GemarkungsteilFlur_Schluessel" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
                <child name="land" ns="http://www.adv-online.de/namespaces/adv/gid/6.0"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="upperLevelUnit" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="#CadastralZoning_{schluessel.AX_GemarkungsteilFlur_Schluessel.land}{schluessel.AX_GemarkungsteilFlur_Schluessel.gemarkung}" name="pattern"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ca6561677-18bf-4882-8f37-04ca5dc53eb4" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6d74ba9c-0bb9-498e-af79-2b46cb780acd" priority="normal">
        <target>
            <property>
                <type name="CadastralZoningType" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/cp/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
</alignment>
